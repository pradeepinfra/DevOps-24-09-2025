#!/bin/bash
set -e

# --- Update system & install Apache ---
apt-get update -y
apt-get install -y apache2
systemctl enable --now apache2

# --- Identify instance hostname ---
HOSTNAME=$(hostname)

# --- Create directories ---
mkdir -p /var/www/html/blue /var/www/html/green

# --- Create BLUE page ---
cat > /var/www/html/blue/index.html <<EOF
<!DOCTYPE html>
<html>
<head>
  <title>Blue Page - $HOSTNAME</title>
  <style>
    body {
      background-color: #007BFF;
      color: white;
      font-family: Arial, sans-serif;
      text-align: center;
      padding-top: 80px;
    }
    h1 {
      font-size: 2.5em;
    }
    p {
      font-size: 1.2em;
    }
  </style>
</head>
<body>
  <h1>Hello from BLUE — $HOSTNAME</h1>
  <p>This is the BLUE demo page served from <strong>$HOSTNAME</strong>.</p>
</body>
</html>
EOF

# --- Create GREEN page ---
cat > /var/www/html/green/index.html <<EOF
<!DOCTYPE html>
<html>
<head>
  <title>Green Page - $HOSTNAME</title>
  <style>
    body {
      background-color: #28A745;
      color: white;
      font-family: Arial, sans-serif;
      text-align: center;
      padding-top: 80px;
    }
    h1 {
      font-size: 2.5em;
    }
    p {
      font-size: 1.2em;
    }
  </style>
</head>
<body>
  <h1>Hello from GREEN — $HOSTNAME</h1>
  <p>This is the GREEN demo page served from <strong>$HOSTNAME</strong>.</p>
</body>
</html>
EOF

# --- Make BLUE page default root ---
cp /var/www/html/blue/index.html /var/www/html/index.html

# --- Adjust permissions & reload Apache ---
chmod -R a+rX /var/www/html
systemctl reload apache2
